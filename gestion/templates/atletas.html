{% extends '_base_layout.html' %}
{% block content %}
<div class="container mt-6">
  <h1>Atletas</h1>
  {% if request.user.is_staff %}
    <div class="mb-3">
      <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#addAtletaForm" aria-expanded="false" aria-controls="addAtletaForm">Agregar atleta</button>
    </div>
    <div class="collapse mb-3" id="addAtletaForm">
      <div class="card card-body">
        <form method="post" action="{% url 'atletas_list' %}">
          {% csrf_token %}
          <div class="row g-2">
            <div class="col-md-4">
              <input name="first_name" class="form-control" placeholder="Nombre" required />
            </div>
            <div class="col-md-4">
              <input name="last_name" class="form-control" placeholder="Apellido" required />
            </div>
            <div class="col-md-3">
              <select name="grupo" class="form-control custom-select" required>
                <option value="">Seleccionar grupo</option>
                {% for g in grupos %}
                  <option value="{{ g.id }}">{{ g.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-1">
              <button class="btn btn-success" type="submit">Crear</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  {% endif %}

  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Nombre</th>
          <th>Grupo</th>
          <th>Exento de pago</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for a in alumnos %}
        <tr>
          <td>{{ forloop.counter0|add:alumnos.start_index }}</td>
          <td>{{ a.first_name }} {{ a.last_name }}</td>
          <td>
            {% if a.grupo %}
              {{ a.grupo.nombre }}
            {% else %}
              &mdash;
            {% endif %}
          </td>
          <td>{% if a.exento_pago %}Sí{% else %}No{% endif %}</td>
          <td>{% if a.is_active %}Sí{% else %}No{% endif %}</td>
          <td>
            {% if request.user.is_staff %}
              <a href="{% url 'admin:gestion_usuario_change' a.id %}">Editar</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="7">No hay atletas registrados.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if paginator.num_pages > 1 %}
    <nav aria-label="Page navigation">
      <ul class="pagination">
        {% if alumnos.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ alumnos.previous_page_number }}">Anterior</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Anterior</span></li>
        {% endif %}
        {% for p in alumnos.paginator.page_range %}
          {% if p == alumnos.number %}
            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ p }}">{{ p }}</a></li>
          {% endif %}
        {% endfor %}
        {% if alumnos.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ alumnos.next_page_number }}">Siguiente</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
